<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Kompas</title>
    <style>
        body {
            margin: 0;
            background-color: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: #5eff5e;
            font-family: monospace;
            overflow: hidden;
            user-select: none;
        }

        /* Kamera na pozad√≠ */
        #video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            display: none; /* Schovan√°, dokud se neaktivuje */
        }

        /* Horn√≠ li≈°ta */
        #top-bar {
            position: absolute;
            top: 40px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            letter-spacing: 8px;
            white-space: nowrap;
            z-index: 10;
        }

        #top-indicator {
            position: absolute;
            transition: transform 0.1s linear;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Hlavn√≠ kruh - upraven na polopr≈Øhledn√Ω */
        #compass-circle {
            width: 280px;
            height: 280px;
            background-color: rgba(13, 20, 13, 0.6); /* Pr≈Øhlednost pro AR efekt */
            border: 1px solid rgba(94, 255, 94, 0.2);
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        #arrow-pivot {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.1s linear;
        }

        .arrow-head {
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 55px solid #5eff5e;
            transform: translateY(-40px);
            filter: drop-shadow(0 0 5px rgba(94, 255, 94, 0.5));
        }

        #center-dot {
            width: 14px;
            height: 14px;
            background-color: #5eff5e;
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 10px rgba(94, 255, 94, 0.8);
        }

        /* Tlaƒç√≠tka */
        #btn-start {
            position: absolute;
            bottom: 60px;
            padding: 15px 30px;
            background: #5eff5e;
            color: #000;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            z-index: 20;
        }

        #cam-toggle {
            position: absolute;
            right: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            background: rgba(94, 255, 94, 0.2);
            border: 2px solid #5eff5e;
            border-radius: 12px;
            color: #5eff5e;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 20;
        }
    </style>
</head>
<body>

    <video id="video-background" autoplay playsinline></video>

    <div id="top-bar">
        <div id="top-indicator">
            <span>¬∑</span><span>‚ñ≤</span><span>¬∑</span><span>¬∑</span><span>¬∑</span><span>¬∑</span><span>‚óè</span><span>¬∑</span><span>¬∑</span><span>¬∑</span><span>¬∑</span><span>¬∑</span><span>¬∑</span>
        </div>
    </div>

    <div id="compass-circle">
        <div id="arrow-pivot">
            <div class="arrow-head"></div>
        </div>
        <div id="center-dot"></div>
    </div>

    <button id="btn-start">AKTIVOVAT SYST√âM</button>
    <div id="cam-toggle" title="P≈ôepnout kameru">üì∑</div>

    <script>
        const arrowPivot = document.getElementById('arrow-pivot');
        const topIndicator = document.getElementById('top-indicator');
        const btnStart = document.getElementById('btn-start');
        const camToggle = document.getElementById('cam-toggle');
        const video = document.getElementById('video-background');

        let cameraActive = false;
        let stream = null;

        // --- Logika Kompasu ---
        function updateOrientation(event) {
            let heading = event.webkitCompassHeading || (360 - event.alpha);
            if (heading !== undefined) {
                arrowPivot.style.transform = `rotate(${-heading}deg)`;
                let moveX = ((heading % 360) - 180) * 0.8;
                topIndicator.style.transform = `translateX(${moveX}px)`;
            }
        }

        // --- Logika Kamery ---
        async function toggleCamera() {
            if (!cameraActive) {
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: "environment" }, 
                        audio: false 
                    });
                    video.srcObject = stream;
                    video.style.display = 'block';
                    cameraActive = true;
                    camToggle.style.background = "#5eff5e";
                    camToggle.style.color = "#000";
                } catch (err) {
                    alert("Nepoda≈ôilo se p≈ôistoupit ke kame≈ôe: " + err);
                }
            } else {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                video.style.display = 'none';
                cameraActive = false;
                camToggle.style.background = "rgba(94, 255, 94, 0.2)";
                camToggle.style.color = "#5eff5e";
            }
        }

        // --- Start ---
        async function init() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                const permission = await DeviceOrientationEvent.requestPermission();
                if (permission === 'granted') {
                    window.addEventListener('deviceorientation', updateOrientation);
                    btnStart.style.display = 'none';
                }
            } else {
                window.addEventListener('deviceorientation', updateOrientation);
                btnStart.style.display = 'none';
            }
        }

        btnStart.addEventListener('click', init);
        camToggle.addEventListener('click', toggleCamera);
    </script>
</body>
</html>
